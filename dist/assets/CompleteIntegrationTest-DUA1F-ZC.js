import{j as e}from"./ui-vendor-CWP_eYGj.js";import{r as N}from"./react-vendor-BCzOm2YP.js";import{u as k,a as C}from"./clerk-dvj8YAJP.js";import{u as T}from"./supabase-clerk-Bitr227S.js";import{C as v,b as A,c as E,B as o,d as $,a as b}from"./index-hD8Lc50L.js";import{N as P,R as L,V as I,z as R}from"./utils-CgNX-I3X.js";import"./supabase-Bc-83CNV.js";function z(){var f;const{user:a,isLoaded:h}=k(),{isSignedIn:u,getToken:x}=C(),d=T(),[g,i]=N.useState({clerkAuth:{status:"pending",message:"Checking Clerk authentication..."},tokenGeneration:{status:"pending",message:"Generating Clerk token..."},supabaseConnection:{status:"pending",message:"Connecting to Supabase..."},rlsPolicy:{status:"pending",message:"Testing RLS policies..."},dataFetch:{status:"pending",message:"Fetching authenticated data..."},userProfile:{status:"pending",message:"Checking user profile sync..."}});N.useEffect(()=>{async function r(){var l;if(h)if(u&&a){i(s=>{var t;return{...s,clerkAuth:{status:"success",message:`✅ Authenticated as: ${((t=a.primaryEmailAddress)==null?void 0:t.emailAddress)||a.id}`}}});try{const s=await x();if(s)i(t=>({...t,tokenGeneration:{status:"success",message:`✅ Token generated (${s.substring(0,20)}...)`}}));else throw new Error("No token received")}catch(s){i(t=>({...t,tokenGeneration:{status:"error",message:`❌ Token generation failed: ${s}`}}))}try{const{data:s,error:t}=await d.from("events").select("id").limit(1);if(t)throw t;i(m=>({...m,supabaseConnection:{status:"success",message:"✅ Supabase connected successfully"}}))}catch(s){i(t=>({...t,supabaseConnection:{status:"error",message:`❌ Connection failed: ${s.message}`}}))}try{const{data:s,error:t}=await d.from("user_profiles").select("*").eq("clerk_user_id",a.id).single();if(t&&t.code!=="PGRST116")throw t;i(n=>({...n,rlsPolicy:{status:"success",message:s?"✅ RLS policies working (user data found)":"✅ RLS policies working (no data yet)"}}));const{data:m,error:j}=await d.from("events").select("*").limit(5);if(j)throw j;if(i(n=>({...n,dataFetch:{status:"success",message:`✅ Fetched ${(m==null?void 0:m.length)||0} events with authentication`}})),s)i(n=>({...n,userProfile:{status:"success",message:`✅ User profile synced (ID: ${s.id})`}}));else{const{error:n}=await d.from("user_profiles").insert({clerk_user_id:a.id,email:((l=a.primaryEmailAddress)==null?void 0:l.emailAddress)||"",full_name:`${a.firstName||""} ${a.lastName||""}`.trim()||"User",role:"organizer"});if(n&&n.code!=="23505")throw n;i(S=>({...S,userProfile:{status:"success",message:"✅ User profile created in Supabase"}}))}}catch(s){i(t=>({...t,rlsPolicy:{status:"error",message:`❌ RLS test failed: ${s.message}`}}))}}else i(s=>({...s,clerkAuth:{status:"error",message:"❌ Not authenticated - Please sign in first"}}))}r()},[h,u,a,x,d]);const w=r=>{switch(r){case"success":return e.jsx(R,{className:"w-5 h-5 text-green-500"});case"error":return e.jsx(I,{className:"w-5 h-5 text-red-500"});case"pending":return e.jsx(L,{className:"w-5 h-5 text-yellow-500 animate-spin"});default:return e.jsx(P,{className:"w-5 h-5 text-gray-500"})}},y=r=>{switch(r){case"success":return e.jsx(o,{className:"bg-green-100 text-green-800",children:"PASS"});case"error":return e.jsx(o,{className:"bg-red-100 text-red-800",children:"FAIL"});case"pending":return e.jsx(o,{className:"bg-yellow-100 text-yellow-800",children:"TESTING"});default:return e.jsx(o,{children:"UNKNOWN"})}},c=Object.values(g).every(r=>r.status==="success"),p=Object.values(g).every(r=>r.status!=="pending");return e.jsx("div",{className:"container mx-auto p-8 max-w-4xl",children:e.jsxs(v,{children:[e.jsx(A,{children:e.jsxs(E,{className:"text-2xl flex items-center justify-between",children:["Clerk + Supabase Integration Test",p&&(c?e.jsx(o,{className:"bg-green-500 text-white text-lg px-4 py-1",children:"ALL TESTS PASSED"}):e.jsx(o,{className:"bg-red-500 text-white text-lg px-4 py-1",children:"SOME TESTS FAILED"}))]})}),e.jsxs($,{className:"space-y-4",children:[a&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Current User"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"ID:"})," ",a.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",((f=a.primaryEmailAddress)==null?void 0:f.emailAddress)||"Not set"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",a.fullName||`${a.firstName} ${a.lastName}`||"Not set"]})]})]}),e.jsx("div",{className:"space-y-3",children:Object.entries(g).map(([r,l])=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[w(l.status),e.jsx("span",{className:"font-medium capitalize",children:r.replace(/([A-Z])/g," $1").trim()})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-600",children:l.message}),y(l.status)]})]},r))}),p&&e.jsxs("div",{className:`p-4 rounded-lg mt-6 ${c?"bg-green-50 border-green-200":"bg-red-50 border-red-200"} border`,children:[e.jsx("h3",{className:`font-semibold mb-2 ${c?"text-green-800":"text-red-800"}`,children:"Test Summary"}),e.jsx("p",{className:`text-sm ${c?"text-green-700":"text-red-700"}`,children:c?"✅ All integration tests passed! The Clerk + Supabase integration is working correctly.":"❌ Some tests failed. Please check the error messages above and ensure you are signed in."}),c&&e.jsxs("div",{className:"mt-3 text-sm text-green-700",children:[e.jsx("p",{className:"font-semibold",children:"Next Steps:"}),e.jsxs("ul",{className:"list-disc list-inside mt-1",children:[e.jsx("li",{children:"Update all dashboard components to use useSupabase hook"}),e.jsx("li",{children:"Test data isolation with different user accounts"}),e.jsx("li",{children:"Deploy to production with production keys"})]})]})]}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx(b,{onClick:()=>window.location.reload(),children:"Run Tests Again"}),!u&&e.jsx(b,{variant:"outline",onClick:()=>window.location.href="/fashionistas100-23b70512/sign-in",children:"Sign In First"})]})]})]})})}export{z as default};
